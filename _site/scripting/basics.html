<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Basics | Frostbite</title>
<meta name="generator" content="Jekyll v3.9.5" />
<meta property="og:title" content="Basics" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="MUD client for dragonrealms." />
<meta property="og:description" content="MUD client for dragonrealms." />
<link rel="canonical" href="http://localhost:4000/scripting/basics.html" />
<meta property="og:url" content="http://localhost:4000/scripting/basics.html" />
<meta property="og:site_name" content="Frostbite" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Basics" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"MUD client for dragonrealms.","headline":"Basics","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"http://localhost:4000/assets/img/logo.png"}},"url":"http://localhost:4000/scripting/basics.html"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="stylesheet" href="/assets/css/style.css?v=a094b754aaa9b43a4e7fd9b2adf347b4695a5343">
    <!--[if lt IE 9]>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.3/html5shiv.min.js"></script>
    <![endif]-->
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->



<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->

<!-- end custom head snippets -->

  </head>
  <body>
    <div class="wrapper">
      <header>
        <h1><a href="http://localhost:4000/">Frostbite</a></h1>
        <h2><a href="http://localhost:4000/">User Guide</a></h1>

        
          <a href="http://localhost:4000/">
            <img src="/assets/img/logo.png" alt="Logo" />
          </a>
        

        <p>MUD client for dragonrealms.</p>

        <a href="http://localhost:4000/">Introduction</a>
        <ol>
          <li><a href="http://localhost:4000/introduction/installation">Installation</a></li>
          <li><a href="http://localhost:4000/introduction/application_software">Application software</a></li>
          <li><a href="http://localhost:4000/introduction/change_log">Change log</a></li>
          <li><a href="http://localhost:4000/introduction/getting_started">Getting started</a></li>
        </ol>
        <a href="http://localhost:4000/user_interface">User interface</a>
        <ol>
          <li><a href="http://localhost:4000/user_interface/client_settings">Client settings</a></li>
          <li><a href="http://localhost:4000/user_interface/maps">Maps</a></li>
          <li><a href="http://localhost:4000/user_interface/profiles">Profiles</a></li>
          <li><a href="http://localhost:4000/user_interface/flags">Server-side flags and settings</a></li>
          <li><a href="http://localhost:4000/user_interface/media">Media - screenshots</a></li>
        </ol>
        <a href="http://localhost:4000/scripting">Scripting</a>
        <ol>
          <li><a href="http://localhost:4000/scripting/basics">Basics</a></li>
          <li><a href="http://localhost:4000/scripting/api">Scripting API</a></li>
          <li><a href="http://localhost:4000/scripting/lich">Scripting with Lich</a></li>
          <li><a href="http://localhost:4000/scripting/development">Development</a></li>
        </ol>
        <br>

        
        <p class="view"><a href="https://github.com/DancingPete/frostbite">View the Project on GitHub <small>DancingPete/frostbite</small></a></p>
        

        

        
        <ul class="downloads">
          <li><a href="https://github.com/matoom/frostbite/releases">Browse <strong>Releases</strong></a></li>
          <li><a href="https://github.com/matoom/frostbite/archive/refs/tags/v1.17.0-beta.tar.gz">Download <strong>TAR Ball</strong></a></li>
          <li><a href="https://github.com/DancingPete/frostbite">View On <strong>GitHub</strong></a></li>
        </ul>
        

        
        <p>This project is maintained by <a href="https://github.com/DancingPete">DancingPete</a></p>
        
        <p><small>Hosted on GitHub Pages &mdash; Theme by <a href="https://github.com/orderedlist">orderedlist</a></small></p>
      </header>
      <section>

      <h2 id="basics">Basics</h2>

<p>The Frostbite client scripting is based on the Ruby scripting language.
Ruby syntax is easy and intuitive to use, it supports multi-paradigm programming
and its functions are very powerful. All of which incorporates
into a very flexible scripting environment.</p>

<p>The descriptions for Ruby functions are available in the
<a href="http://ruby-doc.org/core-1.9.3/">Ruby documentation</a>.</p>

<p>On top of Ruby tools, the Frostbite frontend offers it’s own set of functions
which are more specific to the game itself.
The API description is available in the <a href="/scripting/api">API</a> section.</p>

<h3 id="creating-and-running-scripts">Creating and running scripts</h3>

<p>Ruby script files are required to be created as <em>“.rb”</em> extension files and
the script files need to be placed into the client <em>“scripts”</em> folder.</p>

<p>The scripts can be executed in the client command line by calling the file name
with a <em>”.”</em> prefix.
For example, running braid.rb: <em>“.braid vine”</em>.</p>

<h3 id="stopping-scripts">Stopping scripts</h3>

<p>Once the script is running it can be stopped by pressing the ESC key on the keyboard.
In the event of any crashes which render the script unable to exit in a normal way,
the ESC key has to be pressed once more to terminate the script forcefully.</p>

<p>In case of system-wide crashes terminate the ruby executable in the process list.
For Windows look for ruby.exe in the task manager, for Linux or Max OS X,
Ruby process can be killed on the command line.</p>

<h3 id="reserved-parameter-descriptions">Reserved parameter descriptions</h3>

<p><code class="language-plaintext highlighter-rouge">$args # array, global variable</code></p>

<p>Contains the arguments passed on to the script in the command line.</p>

<p><code class="language-plaintext highlighter-rouge">$rt_adjust = 0 # number, global scope variable</code></p>

<p>Enables to regulate the wait times and make the script run faster by tightening the value.</p>

<p><code class="language-plaintext highlighter-rouge">:match_start and :match_end</code></p>

<p>These are the two reserved match pattern names which can be used to determine
additional match start and end conditions.</p>

<p>For example:</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span>
    <span class="ss">:wait</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/\.\.\.wait|you may only type ahead/</span><span class="p">],</span>
    <span class="ss">:lodged</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/lodged shallowly into/</span><span class="p">],</span>
    <span class="ss">:mites</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/red blood mite/</span><span class="p">],</span>
    <span class="c1"># start matching</span>
    <span class="ss">:match_start</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/Your body feels/</span><span class="p">],</span>
    <span class="c1"># match end conditions (will match everything in between)</span>
    <span class="ss">:match_end</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/&gt;|no significant injuries/</span><span class="p">]</span>
<span class="p">}</span>
</code></pre></div></div>

<h3 id="script-structures-and-blocks">Script structures and blocks</h3>

<p>All the Frostbite API driven scripts can be directed to <em>“finally_do”</em> method at script exit.
This includes either aborting the script or exiting by natural means.
The final block can be avoided by calling <code class="language-plaintext highlighter-rouge">Kernel::exit!</code> or <code class="language-plaintext highlighter-rouge">Kernel::abort</code>.
If the <em>“finally_do”</em> function is not defined in the script, no extra action will be taken
at the script exit.
Finally block is useful when you want to perform clean up tasks after running the script.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">finally_do</span> <span class="p">{</span>
    <span class="n">put</span> <span class="s2">"put my </span><span class="si">#{</span><span class="vg">$args</span><span class="p">.</span><span class="nf">first</span><span class="si">}</span><span class="s2"> in my backpack"</span>
<span class="p">}</span>
</code></pre></div></div>

<p>There are different ways to set up the script flow in Ruby.
With some additions to the standard library
it is possible to create Wizard-like label structures.
For labels to work it is required to wrap the label code into
<em>“labels_start”</em> and <em>“labels_end” markers</em>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>labels_start

label(:study) {
    put "study my compendium"
    match = { :study =&gt; ["studying", "You continue to study"],
    :turn =&gt; ["makes sense to you"],
    :exit =&gt; ["study this chart again"] }
    match_wait_goto match
}

label(:turn) {
    put "turn my compendium"
    wait
    goto :study
}

labels_end
</code></pre></div></div>

<p>The match mechanics can also be executed without labels by calling the <em>“match_wait”</em>
function instead.
This way the keyword <code class="language-plaintext highlighter-rouge">(:symbol)</code> for the match will be returned by the function and
any further action depends on the decision logic that handles those responses.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="n">put</span> <span class="s2">"go rosewood arch"</span>
<span class="n">match</span> <span class="o">=</span> <span class="p">{</span>
    <span class="ss">:second</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"The attendant steps in"</span><span class="p">],</span>
    <span class="ss">:continue</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"The Dwarven attendant escorts"</span><span class="p">]</span>
<span class="p">}</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">match_wait</span> <span class="n">match</span>

<span class="k">case</span> <span class="n">result</span>
    <span class="k">when</span> <span class="ss">:second</span>
    <span class="n">move</span> <span class="s2">"go ironwood arch"</span>
<span class="k">end</span>
</code></pre></div></div>

<p>For avoiding code repetitions, Ruby enables to create functions and loops
to keep the script clean from any redundant code.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">def</span> <span class="nf">juggle</span>
    <span class="n">put</span> <span class="s2">"juggle my "</span> <span class="o">+</span> <span class="vg">$args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
    <span class="n">wait_for_roundtime</span>
<span class="k">end</span>

<span class="mi">10</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
<span class="n">juggle</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="observer-event-module">Observer event module</h3>

<p>The observer module can be set up to watch for pattern matches in the game text.
It runs in parallel with the script flow and will not be disturbed by any blocking
parts of the script, other than the matching mechanics.
The observer will wait for any matching to be finished until it can execute
the callback method for the specified event or otherwise it is not possible
to use the matching mechanics in the callback method’s body.
Once the observer runs into a specified event, the script flow will be
interrupted for the time it takes to execute the callback method.</p>

<p>To set up the observer module it is required to register at least one observer event.
The observer event contains the name of the callback method and the text match pattern
which is being tracked by the observer.
Each event has a specified callback method and it has to be defined in the script
body or otherwise the script will fail to execute.</p>

<p>The observer module is a singleton object and only one instance of the observer
object can be created in each script.
The singleton instance can be obtained by calling the <em>“instance”</em> method of the observer object.
The observer is a lazy initation object, meaning that it will only start running
once the <em>“register_event”</em> is called.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="no">Observer</span><span class="p">.</span><span class="nf">instance</span><span class="p">.</span><span class="nf">register_event</span><span class="p">({</span>
    <span class="ss">:on_roundtime</span> <span class="o">=&gt;</span> <span class="s2">"Roundtime"</span>
<span class="p">})</span>

<span class="no">Observer</span><span class="p">.</span><span class="nf">instance</span><span class="p">.</span><span class="nf">register_event</span><span class="p">({</span>
    <span class="ss">:stop_observer</span> <span class="o">=&gt;</span> <span class="s2">"were you referring"</span>
<span class="p">})</span>


<span class="c1"># callback method for first event</span>
<span class="k">def</span> <span class="nf">on_roundtime</span>
    <span class="n">echo</span> <span class="s2">"Found roundtime!"</span>
    <span class="n">wait_for_roundtime</span>        <span class="c1"># pauses for the duration of roundtime</span>
    <span class="n">put</span> <span class="s2">"look"</span>
<span class="k">end</span>

<span class="c1"># callback method for second event</span>
<span class="k">def</span> <span class="nf">stop_observer</span>
    <span class="no">Observer</span><span class="p">.</span><span class="nf">instance</span><span class="p">.</span><span class="nf">terminate</span> <span class="c1"># just to demonstrate how to</span>
                                <span class="c1"># terminate the observer</span>
<span class="k">end</span>

<span class="mi">100</span><span class="p">.</span><span class="nf">times</span> <span class="k">do</span>
    <span class="n">put</span> <span class="s2">"collect "</span> <span class="o">+</span> <span class="vg">$args</span><span class="p">.</span><span class="nf">join</span><span class="p">(</span><span class="s2">" "</span><span class="p">)</span>
    <span class="n">wait_for_roundtime</span>
    <span class="n">put</span> <span class="s2">"kick pile"</span>
<span class="k">end</span>
</code></pre></div></div>

<h3 id="functions-and-models">Functions and models</h3>

<p>The standard API functions have mostly been set up to provide Wizard-like scripting style.
Different kind of approaches might need changes or additions to the core API functionality.
The full description of the Frostbite core API functions and models can be found from the
<a href="api.html">API</a> section.</p>

<h3 id="errors-in-scripting">Errors in scripting</h3>

<p>Error messages coming from scripts are displayed in the Frostbite client main window.
Scripts containing any errors in syntax or structure can not be used until they are fixed.
The error messages, in most cases, point to the errors by the line number in code to
make them easier to find.</p>

<p>For example, when calling a function which expects a string type but has not been
denoted as such by using quotes.
In Ruby, variables can be created using just alphanumeric characters and underscore.
In this case the word - hello - will be handled as a variable which has no value
assigned, therefore causing an error.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#script</span>
<span class="n">echo</span> <span class="n">hello</span>

<span class="c1">#=&gt;</span>

<span class="c1">#error</span>
<span class="no">C</span><span class="ss">:/</span><span class="no">FrostBite</span><span class="o">/</span><span class="n">scripts</span><span class="o">/</span><span class="n">hello</span><span class="p">.</span><span class="nf">rb</span><span class="p">:</span><span class="mi">1</span><span class="ss">:in</span> <span class="sb">`': undefined local variable or method `</span><span class="n">hello</span><span class="err">'</span> <span class="k">for</span> <span class="n">main</span><span class="ss">:Object</span> <span class="p">(</span><span class="no">NameError</span><span class="p">)</span>
</code></pre></div></div>

<p>Error on line one, undefined local variable. To fix this particular error, the word hello has to be
enclosed in quotes – “hello”.</p>

<h3 id="regular-expressions">Regular expressions</h3>

<p>The match functions in scripts are based on regular expressions.
To use any of the regular expression characters as a literal in a match pattern,
they have to be escaped by a backslash.</p>

<div class="language-ruby highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#escaped to match dot characters instead of any single character</span>
<span class="ss">:wait</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/\.\.\.wait/</span><span class="p">,</span> <span class="s2">"only one command"</span><span class="p">]</span>

<span class="c1">#case insensitive, bracets are escaped to match bracet characters</span>
<span class="ss">:canyon</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="sr">/\[North Road, Canyon\]/i</span><span class="p">]</span>

<span class="c1">#not containing any regular expression special characters</span>
<span class="ss">:exit</span> <span class="o">=&gt;</span> <span class="p">[</span><span class="s2">"study this chart again"</span><span class="p">,</span> <span class="s2">"need to be holding"</span><span class="p">]</span>
</code></pre></div></div>


      </section>
    </div>
    <script src="/assets/js/scale.fix.js"></script>
  </body>
</html>
